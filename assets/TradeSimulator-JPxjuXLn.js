import{u as de,c as w,a as e,w as b,v as g,b as i,F as X,n as m,t as n,d as G,j as ue,e as Y,r as f,f as d,g as ve,h as ce,o as h}from"./index-CtVat6kI.js";import{A as me,C as c,D as pe,Y as Z,X as L,T as j,G as be}from"./useChartTheme-DhzHdu0z.js";const ge={class:"card mb"},ye={class:"g4 mb"},fe={class:"field"},xe={class:"field"},we={class:"field"},he={class:"field"},Se={class:"field"},_e={class:"field"},Te={class:"field"},Le={class:"field"},Re={class:"g4 mb"},ke={class:"big-stat"},Ae={class:"big-stat"},Me={class:"big-stat"},Pe={class:"big-stat"},Ce={class:"big-stat-val red"},$e={class:"g4 mb"},Ve={class:"sc green"},We={class:"sc-val green"},De={class:"sc-delta"},Fe={class:"sc red"},Ie={class:"sc-val red"},Ee={class:"sc-delta"},Ue={class:"sc teal"},ze={class:"sc-val teal"},Be={class:"sc-delta"},Ne={class:"sc orange"},Oe={class:"sc-val orange"},qe={class:"sc-delta"},Xe={class:"sc grey"},Ge={class:"sc-val grey"},Ye={class:"sc grey"},Ze={class:"sc-val grey"},je={class:"card card-teal mb"},He={class:"card card-orange mb"},Ke={class:"card"},Je={class:"card-label"},Qe={class:"tbl-wrap scrollable"},et={class:"tbl"},tt={class:"muted"},lt={class:"teal"},at={key:1,class:"alert alert-teal"},it={__name:"TradeSimulator",setup(st){const u=de(),{fmtINR:R,fmt:v,fmtK:H}=ve(),S=f(""),_=f(""),T=f(""),k=f(""),A=f(30),s=f([]);function I(){const l=u.capital||0,t=(S.value||50)/100,r=(_.value||0)/100,a=(T.value||0)/100,o=(u.riskPct||2)/100,p=u.leverage||1,z=Math.min(k.value||20,500),oe=(A.value||30)/100;if(!l||!r||!a||!z)return;const ie=r/a,B=[];let y=l,x=l;for(let W=1;W<=z;W++){const D=Math.random()<t,N=1+(Math.random()*2-1)*oe,O=y*o*p,F=D?O*ie*N:-O*N,q=Math.abs(F)/y*100;y=Math.max(0,y+F),x=Math.max(x,y);const re=x>0?(x-y)/x*100:0;B.push({n:W,win:D,returnPct:D?q:-q,pnl:F,balance:y,dd:re})}s.value=B}const M=d(()=>{var l;return((l=s.value[s.value.length-1])==null?void 0:l.balance)||0}),P=d(()=>u.capital>0?(M.value-u.capital)/u.capital*100:0),C=d(()=>{const l=(S.value||0)/100,t=_.value||0,r=T.value||0;return l*t-(1-l)*r}),E=d(()=>s.value.filter(l=>l.win).length),U=d(()=>s.value.filter(l=>!l.win).length),K=d(()=>Math.max(0,...s.value.map(l=>l.dd))),J=d(()=>Math.max(0,...s.value.filter(l=>l.win).map(l=>l.returnPct))),Q=d(()=>Math.min(0,...s.value.filter(l=>!l.win).map(l=>l.returnPct))),ee=d(()=>Math.max(0,...s.value.filter(l=>l.win).map(l=>l.pnl))),te=d(()=>Math.min(0,...s.value.filter(l=>!l.win).map(l=>l.pnl))),le=d(()=>{const l=s.value.filter(t=>t.win);return l.length?l.reduce((t,r)=>t+r.pnl,0)/l.length:0}),ae=d(()=>{const l=s.value.filter(t=>!t.win);return l.length?l.reduce((t,r)=>t+r.pnl,0)/l.length:0}),$=d(()=>{let l=0,t=0;return s.value.forEach(r=>{t=r.win?t+1:0,l=Math.max(l,t)}),l}),V=d(()=>{let l=0,t=0;return s.value.forEach(r=>{t=r.win?0:t+1,l=Math.max(l,t)}),l}),se=d(()=>{if(!s.value.length)return{};const l=s.value.map(a=>`T${a.n}`),t=s.value.map(a=>+a.balance.toFixed(2)),r=u.capital;return{backgroundColor:"transparent",grid:be,tooltip:{...j,trigger:"axis",formatter:a=>{var p;const o=s.value[(p=a[0])==null?void 0:p.dataIndex];return o?`<div style="color:rgba(241,243,248,.4);font-size:.58rem;letter-spacing:1px;margin-bottom:8px">TRADE ${o.n}</div>
          <div style="margin-bottom:4px">Result: <span style="color:${o.win?c.green:c.red};font-weight:600">${o.win?"WIN":"LOSS"} ${o.returnPct>=0?"+":""}${o.returnPct.toFixed(2)}%</span></div>
          <div style="margin-bottom:4px">P&L: <span style="color:${o.pnl>=0?c.green:c.red}">${o.pnl>=0?"+":""}₹${Math.abs(o.pnl).toFixed(2)}</span></div>
          <div style="margin-bottom:4px">Balance: <span style="color:${c.teal}">₹${o.balance.toFixed(2)}</span></div>
          <div>Drawdown: <span style="color:${c.red}">−${o.dd.toFixed(2)}%</span></div>`:""}},xAxis:{...L,data:l,axisLabel:{...L.axisLabel,formatter:(a,o)=>s.value.length>50?o%10===0?a:"":o%5===0?a:""}},yAxis:{...Z},dataZoom:pe,series:[{name:"Capital",type:"line",data:t,lineStyle:{color:c.teal,width:2},itemStyle:{color:c.teal},symbol:(a,o)=>{const p=s.value[o.dataIndex];return p?p.win?"circle":"diamond":"none"},symbolSize:(a,o)=>s.value[o.dataIndex]?5:0,itemStyle:{color:a=>{const o=s.value[a.dataIndex];return o?o.win?c.green:c.red:c.teal}},areaStyle:{color:me},smooth:!1,markLine:{silent:!0,symbol:"none",lineStyle:{color:"rgba(255,255,255,.1)",type:"dashed"},data:[{yAxis:r,label:{formatter:`Start ₹${r}`,color:"rgba(241,243,248,.3)",fontFamily:"DM Mono",fontSize:10}}]}}]}}),ne=d(()=>s.value.length?{backgroundColor:"transparent",grid:{top:12,right:16,bottom:36,left:70},tooltip:{...j,trigger:"item",formatter:l=>`<div style="color:${l.color};font-weight:500">${l.data.value>=0?"+":""}${H(l.data.value)}</div>`},xAxis:{...L,data:s.value.map(l=>`T${l.n}`),axisLabel:{...L.axisLabel,formatter:(l,t)=>s.value.length>50?t%10===0?l:"":t%5===0?l:""}},yAxis:{...Z},series:[{name:"P&L",type:"bar",data:s.value.map(l=>({value:+l.pnl.toFixed(2),itemStyle:{color:l.win?"rgba(0,230,118,.65)":"rgba(255,69,96,.6)",borderColor:l.win?c.green:c.red,borderWidth:1,borderRadius:2}})),barMaxWidth:12,markLine:{silent:!0,symbol:"none",lineStyle:{color:"rgba(255,255,255,.1)",type:"dashed"},data:[{yAxis:0}]}}]}:{});return(l,t)=>{const r=ce("VChart");return h(),w("div",null,[t[34]||(t[34]=e("div",{class:"ph"},[e("div",{class:"ph-icon"},"↗"),e("div",null,[e("div",{class:"ph-title"},"Trade Simulator"),e("div",{class:"ph-sub"},"Simulate N individual trades resolved by your win rate and R:R. Re-run for different sequences.")])],-1)),e("div",ge,[t[17]||(t[17]=e("div",{class:"card-label"},"System Parameters",-1)),e("div",ye,[e("div",fe,[t[8]||(t[8]=e("label",null,"Starting Capital (₹)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[0]||(t[0]=a=>i(u).capital=a),placeholder:"e.g. 10000",step:"1000"},null,512),[[g,i(u).capital,void 0,{number:!0}]])]),e("div",xe,[t[9]||(t[9]=e("label",null,"Win Rate (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=a=>S.value=a),placeholder:"e.g. 55",step:"1",min:"1",max:"99"},null,512),[[g,S.value,void 0,{number:!0}]])]),e("div",we,[t[10]||(t[10]=e("label",null,"Avg Win (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=a=>_.value=a),placeholder:"e.g. 6",step:"0.5"},null,512),[[g,_.value,void 0,{number:!0}]])]),e("div",he,[t[11]||(t[11]=e("label",null,"Avg Loss (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=a=>T.value=a),placeholder:"e.g. 3",step:"0.5"},null,512),[[g,T.value,void 0,{number:!0}]])]),e("div",Se,[t[12]||(t[12]=e("label",null,"Risk / Trade (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=a=>i(u).riskPct=a),placeholder:"e.g. 2",step:"0.1"},null,512),[[g,i(u).riskPct,void 0,{number:!0}]])]),e("div",_e,[t[13]||(t[13]=e("label",null,"Leverage",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=a=>i(u).leverage=a),placeholder:"e.g. 1",step:"0.5",min:"1",max:"5"},null,512),[[g,i(u).leverage,void 0,{number:!0}]])]),e("div",Te,[t[14]||(t[14]=e("label",null,"Total Trades",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=a=>k.value=a),placeholder:"e.g. 50",step:"10",min:"5",max:"500"},null,512),[[g,k.value,void 0,{number:!0}]])]),e("div",Le,[t[15]||(t[15]=e("label",null,"Result Variance (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=a=>A.value=a),placeholder:"e.g. 30",step:"10",min:"0",max:"100",title:"% variance around avg win/loss"},null,512),[[g,A.value,void 0,{number:!0}]])])]),e("div",{style:{display:"flex",gap:"12px","align-items":"center","flex-wrap":"wrap"}},[e("button",{class:"btn-action",onClick:I},"▶ Run Simulation"),e("button",{class:"btn-action secondary",onClick:I},"↺ Re-Roll Trades"),t[16]||(t[16]=e("span",{style:{"font-size":".75rem",color:"var(--t3)","font-family":"var(--mono)"}},"Each run produces a unique trade sequence from the same parameters",-1))])]),s.value.length?(h(),w(X,{key:0},[e("div",Re,[e("div",ke,[t[18]||(t[18]=e("div",{class:"big-stat-label"},"Final Capital",-1)),e("div",{class:m(["big-stat-val",M.value>=i(u).capital?"green":"red"])},n(i(R)(M.value)),3)]),e("div",Ae,[t[19]||(t[19]=e("div",{class:"big-stat-label"},"Total Return",-1)),e("div",{class:m(["big-stat-val",P.value>=0?"green":"red"])},n(P.value>=0?"+":"")+n(i(v)(P.value,2))+"%",3)]),e("div",Me,[t[20]||(t[20]=e("div",{class:"big-stat-label"},"Expectancy / Trade",-1)),e("div",{class:m(["big-stat-val",C.value>=0?"teal":"red"])},n(C.value>=0?"+":"")+n(i(v)(C.value,3))+"%",3)]),e("div",Pe,[t[21]||(t[21]=e("div",{class:"big-stat-label"},"Max Drawdown",-1)),e("div",Ce,"−"+n(i(v)(K.value,2))+"%",1)])]),e("div",$e,[e("div",Ve,[t[22]||(t[22]=e("div",{class:"sc-label"},"Wins",-1)),e("div",We,n(E.value),1),e("div",De,n(i(v)(E.value/s.value.length*100,1))+"% actual win rate",1)]),e("div",Fe,[t[23]||(t[23]=e("div",{class:"sc-label"},"Losses",-1)),e("div",Ie,n(U.value),1),e("div",Ee,n(i(v)(U.value/s.value.length*100,1))+"% actual loss rate",1)]),e("div",Ue,[t[24]||(t[24]=e("div",{class:"sc-label"},"Best Trade",-1)),e("div",ze,"+"+n(i(v)(J.value,2))+"%",1),e("div",Be,n(i(R)(ee.value)),1)]),e("div",Ne,[t[25]||(t[25]=e("div",{class:"sc-label"},"Worst Trade",-1)),e("div",Oe,n(i(v)(Q.value,2))+"%",1),e("div",qe,n(i(R)(te.value)),1)]),e("div",Xe,[t[26]||(t[26]=e("div",{class:"sc-label"},"Avg Win",-1)),e("div",Ge,"+"+n(i(v)(le.value,2)),1)]),e("div",Ye,[t[27]||(t[27]=e("div",{class:"sc-label"},"Avg Loss",-1)),e("div",Ze,n(i(v)(ae.value,2)),1)]),e("div",{class:m(["sc",$.value>=3?"green":"grey"])},[t[28]||(t[28]=e("div",{class:"sc-label"},"Max Win Streak",-1)),e("div",{class:m(["sc-val",$.value>=3?"green":"grey"])},n($.value),3)],2),e("div",{class:m(["sc",V.value>=3?"red":"grey"])},[t[29]||(t[29]=e("div",{class:"sc-label"},"Max Loss Streak",-1)),e("div",{class:m(["sc-val",V.value>=3?"red":"grey"])},n(V.value),3)],2)]),e("div",je,[t[30]||(t[30]=e("div",{class:"card-label"},"Equity Curve — Trade by Trade · Hover for details",-1)),G(r,{option:se.value,autoresize:"",style:{height:"300px"}},null,8,["option"])]),e("div",He,[t[31]||(t[31]=e("div",{class:"card-label"},"Trade P&L Distribution",-1)),G(r,{option:ne.value,autoresize:"",style:{height:"220px"}},null,8,["option"])]),e("div",Ke,[e("div",Je,"Trade Log — All "+n(s.value.length)+" Trades",1),e("div",Qe,[e("table",et,[t[32]||(t[32]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Result"),e("th",null,"Return (%)"),e("th",null,"Trade P&L (₹)"),e("th",null,"Running Balance (₹)"),e("th",null,"Drawdown (%)")])],-1)),e("tbody",null,[(h(!0),w(X,null,ue(s.value,a=>(h(),w("tr",{key:a.n},[e("td",tt,n(a.n),1),e("td",null,[e("span",{class:m(a.win?"badge badge-win":"badge badge-loss")},n(a.win?"WIN":"LOSS"),3)]),e("td",{class:m(a.win?"green":"red")},n(a.win?"+":"")+n(i(v)(a.returnPct,2))+"%",3),e("td",{class:m(a.win?"green":"red")},n(a.win?"+":"")+n(i(v)(a.pnl,2)),3),e("td",lt,n(i(v)(a.balance,2)),1),e("td",{class:m(a.dd>1?"red":"muted")},n(a.dd>0?"−":"")+n(i(v)(a.dd,2))+"%",3)]))),128))])])])])],64)):(h(),w("div",at,[...t[33]||(t[33]=[Y(" Fill in your system parameters above and click ",-1),e("strong",null,"Run Simulation",-1),Y(" to see a trade-by-trade breakdown of your strategy's performance. ",-1)])]))])}}};export{it as default};
