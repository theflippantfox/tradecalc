import{u as ie,c as h,a as e,w as b,v as g,b as i,F as O,n as m,t as n,d as q,j as re,e as X,r as x,f as d,g as de,h as ue,o as S}from"./index-Bd7vVtE-.js";import{A as ve,C as c,D as ce,Y as G,X as M,T as Y,G as me}from"./useChartTheme-gAWqYwHT.js";const pe={class:"card mb"},be={class:"g4 mb"},ge={class:"field"},ye={class:"field"},xe={class:"field"},fe={class:"field"},we={class:"field"},he={class:"field"},Se={class:"field"},_e={class:"field"},Te={class:"g4 mb"},Le={class:"big-stat"},Me={class:"big-stat"},ke={class:"big-stat"},Ae={class:"big-stat"},Re={class:"big-stat-val red"},Pe={class:"g4 mb"},Ce={class:"sc green"},$e={class:"sc-val green"},Ve={class:"sc-delta"},We={class:"sc red"},De={class:"sc-val red"},Fe={class:"sc-delta"},Ie={class:"sc teal"},Ee={class:"sc-val teal"},Ue={class:"sc-delta"},ze={class:"sc orange"},Be={class:"sc-val orange"},Ne={class:"sc-delta"},Oe={class:"sc grey"},qe={class:"sc-val grey"},Xe={class:"sc grey"},Ge={class:"sc-val grey"},Ye={class:"card card-teal mb"},Ze={class:"card card-orange mb"},je={class:"card"},He={class:"card-label"},Ke={class:"tbl-wrap scrollable"},Je={class:"tbl"},Qe={class:"muted"},et={class:"teal"},tt={key:1,class:"alert alert-teal"},nt={__name:"TradeSimulator",setup(lt){const u=ie(),{fmtINR:k,fmt:v,fmtK:Z}=de(),f=x(""),_=x(""),T=x(""),A=x(""),R=x(30),s=x([]);function F(){const l=u.capital||0,t=(f.value||50)/100,r=(_.value||0)/100,a=(T.value||0)/100,o=(u.riskPct||2)/100,p=u.leverage||1,U=Math.min(A.value||20,500),se=(R.value||30)/100;if(!l||!r||!a||!U)return;const z=[];let y=l,w=l;for(let D=1;D<=U;D++){const L=Math.random()<t,ne=1+(Math.random()*2-1)*se,B=(L?r:a)*ne,N=(L?1:-1)*y*o*p*(B/Math.max(r,a));y=Math.max(0,y+N),w=Math.max(w,y);const oe=w>0?(w-y)/w*100:0;z.push({n:D,win:L,returnPct:(L?1:-1)*Math.abs(B)*100,pnl:N,balance:y,dd:oe})}s.value=z}const P=d(()=>{var l;return((l=s.value[s.value.length-1])==null?void 0:l.balance)||0}),C=d(()=>u.capital>0?(P.value-u.capital)/u.capital*100:0),$=d(()=>(f.value||0)/100*(_.value||0)-(1-(f.value||0)/100)*(T.value||0)),I=d(()=>s.value.filter(l=>l.win).length),E=d(()=>s.value.filter(l=>!l.win).length),j=d(()=>Math.max(0,...s.value.map(l=>l.dd))),H=d(()=>Math.max(0,...s.value.filter(l=>l.win).map(l=>l.returnPct))),K=d(()=>Math.min(0,...s.value.filter(l=>!l.win).map(l=>l.returnPct))),J=d(()=>Math.max(0,...s.value.filter(l=>l.win).map(l=>l.pnl))),Q=d(()=>Math.min(0,...s.value.filter(l=>!l.win).map(l=>l.pnl))),ee=d(()=>{const l=s.value.filter(t=>t.win);return l.length?l.reduce((t,r)=>t+r.pnl,0)/l.length:0}),te=d(()=>{const l=s.value.filter(t=>!t.win);return l.length?l.reduce((t,r)=>t+r.pnl,0)/l.length:0}),V=d(()=>{let l=0,t=0;return s.value.forEach(r=>{t=r.win?t+1:0,l=Math.max(l,t)}),l}),W=d(()=>{let l=0,t=0;return s.value.forEach(r=>{t=r.win?0:t+1,l=Math.max(l,t)}),l}),le=d(()=>{if(!s.value.length)return{};const l=s.value.map(a=>`T${a.n}`),t=s.value.map(a=>+a.balance.toFixed(2)),r=u.capital;return{backgroundColor:"transparent",grid:me,tooltip:{...Y,trigger:"axis",formatter:a=>{var p;const o=s.value[(p=a[0])==null?void 0:p.dataIndex];return o?`<div style="color:rgba(241,243,248,.4);font-size:.58rem;letter-spacing:1px;margin-bottom:8px">TRADE ${o.n}</div>
          <div style="margin-bottom:4px">Result: <span style="color:${o.win?c.green:c.red};font-weight:600">${o.win?"WIN":"LOSS"} ${o.returnPct>=0?"+":""}${o.returnPct.toFixed(2)}%</span></div>
          <div style="margin-bottom:4px">P&L: <span style="color:${o.pnl>=0?c.green:c.red}">${o.pnl>=0?"+":""}₹${Math.abs(o.pnl).toFixed(2)}</span></div>
          <div style="margin-bottom:4px">Balance: <span style="color:${c.teal}">₹${o.balance.toFixed(2)}</span></div>
          <div>Drawdown: <span style="color:${c.red}">−${o.dd.toFixed(2)}%</span></div>`:""}},xAxis:{...M,data:l,axisLabel:{...M.axisLabel,formatter:(a,o)=>s.value.length>50?o%10===0?a:"":o%5===0?a:""}},yAxis:{...G},dataZoom:ce,series:[{name:"Capital",type:"line",data:t,lineStyle:{color:c.teal,width:2},itemStyle:{color:c.teal},symbol:(a,o)=>{const p=s.value[o.dataIndex];return p?p.win?"circle":"diamond":"none"},symbolSize:(a,o)=>s.value[o.dataIndex]?5:0,itemStyle:{color:a=>{const o=s.value[a.dataIndex];return o?o.win?c.green:c.red:c.teal}},areaStyle:{color:ve},smooth:!1,markLine:{silent:!0,symbol:"none",lineStyle:{color:"rgba(255,255,255,.1)",type:"dashed"},data:[{yAxis:r,label:{formatter:`Start ₹${r}`,color:"rgba(241,243,248,.3)",fontFamily:"DM Mono",fontSize:10}}]}}]}}),ae=d(()=>s.value.length?{backgroundColor:"transparent",grid:{top:12,right:16,bottom:36,left:70},tooltip:{...Y,trigger:"item",formatter:l=>`<div style="color:${l.color};font-weight:500">${l.data.value>=0?"+":""}${Z(l.data.value)}</div>`},xAxis:{...M,data:s.value.map(l=>`T${l.n}`),axisLabel:{...M.axisLabel,formatter:(l,t)=>s.value.length>50?t%10===0?l:"":t%5===0?l:""}},yAxis:{...G},series:[{name:"P&L",type:"bar",data:s.value.map(l=>({value:+l.pnl.toFixed(2),itemStyle:{color:l.win?"rgba(0,230,118,.65)":"rgba(255,69,96,.6)",borderColor:l.win?c.green:c.red,borderWidth:1,borderRadius:2}})),barMaxWidth:12,markLine:{silent:!0,symbol:"none",lineStyle:{color:"rgba(255,255,255,.1)",type:"dashed"},data:[{yAxis:0}]}}]}:{});return(l,t)=>{const r=ue("VChart");return S(),h("div",null,[t[34]||(t[34]=e("div",{class:"ph"},[e("div",{class:"ph-icon"},"↗"),e("div",null,[e("div",{class:"ph-title"},"Trade Simulator"),e("div",{class:"ph-sub"},"Simulate N individual trades resolved by your win rate and R:R. Re-run for different sequences.")])],-1)),e("div",pe,[t[17]||(t[17]=e("div",{class:"card-label"},"System Parameters",-1)),e("div",be,[e("div",ge,[t[8]||(t[8]=e("label",null,"Starting Capital (₹)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[0]||(t[0]=a=>i(u).capital=a),placeholder:"e.g. 10000",step:"1000"},null,512),[[g,i(u).capital,void 0,{number:!0}]])]),e("div",ye,[t[9]||(t[9]=e("label",null,"Win Rate (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),placeholder:"e.g. 55",step:"1",min:"1",max:"99"},null,512),[[g,f.value,void 0,{number:!0}]])]),e("div",xe,[t[10]||(t[10]=e("label",null,"Avg Win (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=a=>_.value=a),placeholder:"e.g. 6",step:"0.5"},null,512),[[g,_.value,void 0,{number:!0}]])]),e("div",fe,[t[11]||(t[11]=e("label",null,"Avg Loss (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=a=>T.value=a),placeholder:"e.g. 3",step:"0.5"},null,512),[[g,T.value,void 0,{number:!0}]])]),e("div",we,[t[12]||(t[12]=e("label",null,"Risk / Trade (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=a=>i(u).riskPct=a),placeholder:"e.g. 2",step:"0.1"},null,512),[[g,i(u).riskPct,void 0,{number:!0}]])]),e("div",he,[t[13]||(t[13]=e("label",null,"Leverage",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=a=>i(u).leverage=a),placeholder:"e.g. 1",step:"0.5",min:"1",max:"5"},null,512),[[g,i(u).leverage,void 0,{number:!0}]])]),e("div",Se,[t[14]||(t[14]=e("label",null,"Total Trades",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=a=>A.value=a),placeholder:"e.g. 50",step:"10",min:"5",max:"500"},null,512),[[g,A.value,void 0,{number:!0}]])]),e("div",_e,[t[15]||(t[15]=e("label",null,"Result Variance (%)",-1)),b(e("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=a=>R.value=a),placeholder:"e.g. 30",step:"10",min:"0",max:"100",title:"% variance around avg win/loss"},null,512),[[g,R.value,void 0,{number:!0}]])])]),e("div",{style:{display:"flex",gap:"12px","align-items":"center","flex-wrap":"wrap"}},[e("button",{class:"btn-action",onClick:F},"▶ Run Simulation"),e("button",{class:"btn-action secondary",onClick:F},"↺ Re-Roll Trades"),t[16]||(t[16]=e("span",{style:{"font-size":".75rem",color:"var(--t3)","font-family":"var(--mono)"}},"Each run produces a unique trade sequence from the same parameters",-1))])]),s.value.length?(S(),h(O,{key:0},[e("div",Te,[e("div",Le,[t[18]||(t[18]=e("div",{class:"big-stat-label"},"Final Capital",-1)),e("div",{class:m(["big-stat-val",P.value>=i(u).capital?"green":"red"])},n(i(k)(P.value)),3)]),e("div",Me,[t[19]||(t[19]=e("div",{class:"big-stat-label"},"Total Return",-1)),e("div",{class:m(["big-stat-val",C.value>=0?"green":"red"])},n(C.value>=0?"+":"")+n(i(v)(C.value,2))+"%",3)]),e("div",ke,[t[20]||(t[20]=e("div",{class:"big-stat-label"},"Expectancy / Trade",-1)),e("div",{class:m(["big-stat-val",$.value>=0?"teal":"red"])},n($.value>=0?"+":"")+n(i(v)($.value,3))+"%",3)]),e("div",Ae,[t[21]||(t[21]=e("div",{class:"big-stat-label"},"Max Drawdown",-1)),e("div",Re,"−"+n(i(v)(j.value,2))+"%",1)])]),e("div",Pe,[e("div",Ce,[t[22]||(t[22]=e("div",{class:"sc-label"},"Wins",-1)),e("div",$e,n(I.value),1),e("div",Ve,n(i(v)(I.value/s.value.length*100,1))+"% actual win rate",1)]),e("div",We,[t[23]||(t[23]=e("div",{class:"sc-label"},"Losses",-1)),e("div",De,n(E.value),1),e("div",Fe,n(i(v)(E.value/s.value.length*100,1))+"% actual loss rate",1)]),e("div",Ie,[t[24]||(t[24]=e("div",{class:"sc-label"},"Best Trade",-1)),e("div",Ee,"+"+n(i(v)(H.value,2))+"%",1),e("div",Ue,n(i(k)(J.value)),1)]),e("div",ze,[t[25]||(t[25]=e("div",{class:"sc-label"},"Worst Trade",-1)),e("div",Be,n(i(v)(K.value,2))+"%",1),e("div",Ne,n(i(k)(Q.value)),1)]),e("div",Oe,[t[26]||(t[26]=e("div",{class:"sc-label"},"Avg Win",-1)),e("div",qe,"+"+n(i(v)(ee.value,2)),1)]),e("div",Xe,[t[27]||(t[27]=e("div",{class:"sc-label"},"Avg Loss",-1)),e("div",Ge,n(i(v)(te.value,2)),1)]),e("div",{class:m(["sc",V.value>=3?"green":"grey"])},[t[28]||(t[28]=e("div",{class:"sc-label"},"Max Win Streak",-1)),e("div",{class:m(["sc-val",V.value>=3?"green":"grey"])},n(V.value),3)],2),e("div",{class:m(["sc",W.value>=3?"red":"grey"])},[t[29]||(t[29]=e("div",{class:"sc-label"},"Max Loss Streak",-1)),e("div",{class:m(["sc-val",W.value>=3?"red":"grey"])},n(W.value),3)],2)]),e("div",Ye,[t[30]||(t[30]=e("div",{class:"card-label"},"Equity Curve — Trade by Trade · Hover for details",-1)),q(r,{option:le.value,autoresize:"",style:{height:"300px"}},null,8,["option"])]),e("div",Ze,[t[31]||(t[31]=e("div",{class:"card-label"},"Trade P&L Distribution",-1)),q(r,{option:ae.value,autoresize:"",style:{height:"220px"}},null,8,["option"])]),e("div",je,[e("div",He,"Trade Log — All "+n(s.value.length)+" Trades",1),e("div",Ke,[e("table",Je,[t[32]||(t[32]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Result"),e("th",null,"Return (%)"),e("th",null,"Trade P&L (₹)"),e("th",null,"Running Balance (₹)"),e("th",null,"Drawdown (%)")])],-1)),e("tbody",null,[(S(!0),h(O,null,re(s.value,a=>(S(),h("tr",{key:a.n},[e("td",Qe,n(a.n),1),e("td",null,[e("span",{class:m(a.win?"badge badge-win":"badge badge-loss")},n(a.win?"WIN":"LOSS"),3)]),e("td",{class:m(a.win?"green":"red")},n(a.win?"+":"")+n(i(v)(a.returnPct,2))+"%",3),e("td",{class:m(a.win?"green":"red")},n(a.win?"+":"")+n(i(v)(a.pnl,2)),3),e("td",et,n(i(v)(a.balance,2)),1),e("td",{class:m(a.dd>1?"red":"muted")},n(a.dd>0?"−":"")+n(i(v)(a.dd,2))+"%",3)]))),128))])])])])],64)):(S(),h("div",tt,[...t[33]||(t[33]=[X(" Fill in your system parameters above and click ",-1),e("strong",null,"Run Simulation",-1),X(" to see a trade-by-trade breakdown of your strategy's performance. ",-1)])]))])}}};export{nt as default};
